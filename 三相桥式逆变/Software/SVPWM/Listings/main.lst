C51 COMPILER V9.59.0.0   MAIN                                                              06/25/2024 10:27:04 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Apps\Keil5_v5\C51\BIN\C51.EXE src\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REG51.H>
   2          #include "intrins.h"
   3          
   4          #define uint16 unsigned int 
   5          #define uint8 unsigned char 
   6            
   7          
   8          sbit A_H = P1^0;
   9          sbit A_L = P1^1;
  10          sbit B_H = P1^2;
  11          sbit B_L = P1^3;
  12          sbit C_H = P1^4;
  13          sbit C_L = P1^5;
  14          
  15          sbit KEY_UP = P2^5;
  16          sbit KEY_DOWN = P2^7;
  17          
  18          
  19          
  20          /*正弦函数查表*/
  21          signed int code spwm[]={
  22          1,5,9,13,17,21,25,29,33,37,41,44,48,52,56,60,64,67,71,75,79,82,86,90,93,97,101,104,108,111,115,118,122,125
             -,128,132,
  23          135,138,142,145,148,151,154,157,160,163,166,169,172,175,178,180,183,186,188,191,193,196,198,201,203,205,20
             -7,209,212,
  24          214,216,218,219,221,223,225,226,228,230,231,233,234,235,237,238,239,240,241,242,243,244,245,245,246,247,24
             -7,248,248,
  25          248,249,249,249,249,249,249,249,249,249,249,248,248,248,247,247,246,245,245,244,243,242,241,240,239,238,23
             -7,235,234,
  26          233,231,230,228,226,225,223,221,219,218,216,214,212,209,207,205,203,201,198,196,193,191,188,186,183,180,17
             -8,175,172,
  27          169,166,163,160,157,154,151,148,145,142,138,135,132,128,125,122,118,115,111,108,104,101,97,93,90,86,82,79,
             -75,71,67,64,
  28          60,56,52,48,44,41,37,33,29,25,21,17,13,9,5,1,-2,-6,-10,-14,-18,-22,-26,-30,-34,-38,-42,-45,-49,-53,-57,-61
             -,-65,-68,-72,
  29          -76,-80,-83,-87,-91,-94,-98,-102,-105,-109,-112,-116,-119,-123,-126,-129,-133,-136,-139,-143,-146,-149,-15
             -2,-155,-158,
  30          -161,-164,-167,-170,-173,-176,-179,-181,-184,-187,-189,-192,-194,-197,-199,-202,-204,-206,-208,-210,-213,-
             -215,-217,-219,
  31          -220,-222,-224,-226,-227,-229,-231,-232,-234,-235,-236,-238,-239,-240,-241,-242,-243,-244,-245,-246,-246,-
             -247,-248,-248,
  32          -249,-249,-249,-250,-250,-250,-250,-250,-250,-250,-250,-250,-250,-249,-249,-249,-248,-248,-247,-246,-246,-
             -245,-244,-243,
  33          -242,-241,-240,-239,-238,-236,-235,-234,-232,-231,-229,-227,-226,-224,-222,-220,-219,-217,-215,-213,-210,-
             -208,-206,-204,
  34          -202,-199,-197,-194,-192,-189,-187,-184,-181,-179,-176,-173,-170,-167,-164,-161,-158,-155,-152,-149,-146,-
             -143,-139,-136,
  35          -133,-129,-126,-123,-119,-116,-112,-109,-105,-102,-98,-94,-91,-87,-83,-80,-76,-72,-68,-65,-61,-57,-53,-49,
             --45,-42,-38,-
  36          34,-30,-26,-22,-18,-14,-10,-6,-2
  37          };
  38          
  39          void Delay_ms(int t)
  40          {
C51 COMPILER V9.59.0.0   MAIN                                                              06/25/2024 10:27:04 PAGE 2   

  41   1        unsigned char n, m;
  42   1        while(t--){
  43   2          n = 12;
  44   2          m = 169;
  45   2          do
  46   2          {
  47   3            while (--m);
  48   3          } while (--n);
  49   2        }
  50   1      }
  51          
  52          int F_r,F_c,Ts,j,flag;
  53          int cnt = 0;
  54          int a_i = 0,b_i=134,c_i=266;
  55          
  56          //使用异步调制，载波频率为2000Hz
  57          void main(void)
  58          {
  59   1        F_c = 2000; //载波频率(Hz)
  60   1        F_r = 1;   //SPWM频率(Hz)
  61   1        Ts = 2.5*(F_c/F_r);//根据步长设定调制波取20个点，将一个调制波分为4等分，每等分瞬时变化最大值为250，
  62   1        TMOD |= 0x10; //模式1(16位定时器)
  63   1        TH1 = (65536-Ts)/256; 
  64   1        TL1 = (65536-Ts)%256;
  65   1        PT1 = 1;
  66   1        ET1 = 1;
  67   1        
  68   1        EA  = 1;
  69   1        
  70   1        TR1 = 1;
  71   1        KEY_UP = 1;
  72   1        KEY_DOWN = 1;
  73   1        
  74   1        
  75   1        //Delay_ms(5000);
  76   1        
  77   1        while(1)
  78   1        {
  79   2          if(!KEY_UP)
  80   2          {
  81   3            _nop_();_nop_();
  82   3            if(!KEY_UP)
  83   3            {
  84   4              F_r += 5;
  85   4              if(F_r>50)F_r = 50;
  86   4              Ts  = 2500/F_r;
  87   4            }
  88   3          }
  89   2          if(!KEY_DOWN)
  90   2          {
  91   3            _nop_();_nop_();
  92   3            if(!KEY_DOWN)
  93   3            {
  94   4              F_r -= 5;
  95   4              if(F_r<1)F_r = 1;
  96   4              Ts  = 2500/F_r;
  97   4            }
  98   3          }
  99   2        }
 100   1      }
 101          
 102          void Timer1_ISR() interrupt 3 using 1
C51 COMPILER V9.59.0.0   MAIN                                                              06/25/2024 10:27:04 PAGE 3   

 103          {
 104   1        TH1 = (65536-Ts)/256;
 105   1        TL1 = (65536-Ts)%256;
 106   1        //比较载波与调制波
 107   1        //A相
 108   1        if(cnt<=spwm[a_i])
 109   1        {
 110   2          A_L=0; 
 111   2          for(j=2;j>0;j--); //延时5us产生死区
 112   2          A_H=1;
 113   2        }
 114   1        if(cnt>spwm[a_i])
 115   1        {
 116   2          A_H=0; 
 117   2          for(j=2;j>0;j--); //延时5us产生死区
 118   2          A_L=1;
 119   2        }
 120   1        //B相
 121   1        if(cnt<=spwm[b_i])
 122   1        {
 123   2          B_L=0; 
 124   2          for(j=2;j>0;j--); //延时5us产生死区
 125   2          B_H=1;
 126   2        }
 127   1        if(cnt>spwm[b_i])
 128   1        {
 129   2          B_H=0; 
 130   2          for(j=2;j>0;j--); //延时5us产生死区
 131   2          B_L=1;
 132   2        }
 133   1        //C相
 134   1        if(cnt<=spwm[c_i])
 135   1        {
 136   2          C_L=0; 
 137   2          for(j=2;j>0;j--); //延时5us产生死区
 138   2          C_H=1;
 139   2        }
 140   1        if(cnt>spwm[c_i])
 141   1        {
 142   2          C_H=0; 
 143   2          for(j=2;j>0;j--); //延时5us产生死区
 144   2          C_L=1;
 145   2        } 
 146   1        
 147   1        //判断载波上升还是下降
 148   1        if(flag)
 149   1          cnt += Ts;    
 150   1        else            
 151   1          cnt -= Ts;    
 152   1        //判断cnt是否达到最高值或最低值，并置flag
 153   1        if(cnt > 250)
 154   1        {
 155   2          cnt = 250;
 156   2          flag=0;
 157   2        }
 158   1        if(cnt<-250) 
 159   1        {
 160   2          cnt = -250;
 161   2          flag=1;
 162   2        }
 163   1        //spwm索引递增
 164   1        a_i++;
C51 COMPILER V9.59.0.0   MAIN                                                              06/25/2024 10:27:04 PAGE 4   

 165   1        if(a_i==400)//索引越界判断
 166   1        {
 167   2          a_i=0;
 168   2        }
 169   1        b_i++;
 170   1        if(b_i==400)//索引越界判断
 171   1        {
 172   2          b_i=0;
 173   2        }
 174   1        c_i++;
 175   1        if(c_i==400)//索引越界判断
 176   1        {
 177   2          c_i=0;
 178   2        }
 179   1      }
 180          
 181          
 182          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    892    ----
   CONSTANT SIZE    =    800    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
